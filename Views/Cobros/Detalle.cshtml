@model ProyectoFinalPogragamacionVI.Models.DetalleCobroViewModel

@{
    ViewBag.Title = "Detalle del Cobro";
}

@* Titulo *@
<div class="text-center my-4">
    <h2 class="fw-bold text-primary">Detalle del Cobro</h2>
</div>

@* Detalle cel cobro *@
<div class="card shadow mb-4">
    <div class="card-header bg-light fw-bold">
        Información General
    </div>
    <div class="card-body">
        <table class="table table-bordered table-sm">
            <tbody>
                <tr>
                    <th>ID Cobro</th>
                    <td>@Model.Detalle.Id_cobro</td>
                </tr>
                <tr>
                    <th>Nombre de Casa</th>
                    <td>@Model.Detalle.Nombre_casa</td>
                </tr>
                <tr>
                    <th>Propietario</th>
                    <td>@Model.Detalle.Nombre_cliente</td>
                </tr>
                <tr>
                    <th>Mes</th>
                    <td>@Model.Detalle.Mes</td>
                </tr>
                <tr>
                    <th>Año</th>
                    <td>@Model.Detalle.Año</td>
                </tr>
                <tr>
                    <th>Estado</th>
                    <td>
                        @if (Model.Detalle.Estado.Equals("Pagado", StringComparison.OrdinalIgnoreCase))
                        {
                            <span class="badge bg-success">Pagado</span>
                        }
                        else if (Model.Detalle.Estado.Equals("Pendiente", StringComparison.OrdinalIgnoreCase))
                        {
                            <span class="badge bg-warning text-dark">Pendiente</span>
                        }
                        else if (Model.Detalle.Estado.Equals("Eliminado", StringComparison.OrdinalIgnoreCase))
                        {
                            <span class="badge bg-danger">Eliminado</span>
                        }
                    </td>
                </tr>
                <tr>
                    <th>Monto Cobro</th>
                    <td>@Model.Detalle.Monto.ToString("C")</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

@* Servicios que estan incluidos *@
<div class="card shadow mb-4">
    <div class="card-header bg-light fw-bold">Servicios Incluidos</div>
    <div class="card-body">
        <ul class="list-group list-group-flush">
            @foreach (var servicio in Model.Servicios)
            {
                <li class="list-group-item">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" disabled @(servicio.Incluido ? "checked" : "") />
                        <label class="form-check-label">@servicio.Nombre</label>
                    </div>
                </li>
            }
        </ul>
    </div>
</div>

@*Botones de acción (si es empleado y el cobro está pendiente)*@
@if (
    Model.Detalle.Estado.Equals("Pendiente", StringComparison.OrdinalIgnoreCase) &&
    Session["es_empleado"] != null &&
    Convert.ToInt32(Session["es_empleado"]) == 1
)
{
    <div class="mb-4 d-flex flex-wrap gap-2">
        <a href="@Url.Action("Editar", "Cobros", new { id = Model.Detalle.Id_cobro })" class="btn btn-primary">
            <i class="bi bi-pencil-square me-1"></i>Editar
        </a>

        @using (Html.BeginForm("Pagar", "Cobros", FormMethod.Post, new { @class = "d-inline" }))
        {
            @Html.AntiForgeryToken()
            @Html.Hidden("id", Model.Detalle.Id_cobro)
            <button type="submit" class="btn btn-success">
                <i class="bi bi-cash-coin me-1"></i>Pagar
            </button>
        }

        @using (Html.BeginForm("Eliminar", "Cobros", new { id = Model.Detalle.Id_cobro }, FormMethod.Post))
        {
            <button type="submit" class="btn btn-danger" onclick="return confirm('¿Está seguro de eliminar este cobro?');">
                <i class="bi bi-trash me-1"></i>Eliminar
            </button>
        }
    </div>
}

 @*Bitácora de acciones*@ 
<div class="card shadow mb-4">
    <div class="card-header bg-light fw-bold">Bitácora de Acciones</div>
    <div class="card-body p-0">
        <table class="table table-bordered table-striped table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Fecha</th>
                    <th>Acción</th>
                    <th>Detalle</th>
                    <th>Realizado por</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var log in Model.Bitacora)
                {
                    <tr>
                        <td>@log.Fecha.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>@log.Accion</td>
                        <td>@log.Detalle</td>
                        <td>@log.RealizadoPor</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@*Boton regresas*@
<div class="text-end">
    <a href="@Url.Action("Index", "Empleado")" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Regresar
    </a>
</div>


